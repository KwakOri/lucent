# Auth – Login Spec

이 문서는 **로그인(Login)** 정책과 보안 관점의 **Rate Limit 전략**을 정의한다.

---

## 1. 기본 원칙

- 인증 시스템은 **Supabase Auth**를 사용한다.
- 로그인은 Supabase의 기본 이메일/비밀번호 인증을 사용한다.
- 이메일 인증이 완료되지 않은 계정은 로그인할 수 없다.
- 로그인 API는 **Next.js API Router**를 통해 서버에서 처리한다.

---

## 2. 로그인 정책

### 2.1 로그인 조건

- 회원가입이 완료된 사용자
- 이메일 인증 완료 상태

### 2.2 허용 방식

- 이메일 + 비밀번호
- 소셜 로그인은 초기 범위에서 제외

---

## 3. 로그인 플로우

```
POST /api/auth/login
```

### 입력값

- email
- password

### 처리 흐름

1. 서버에서 Supabase Auth 로그인 요청
2. 이메일 인증 여부 확인
3. 성공 시 세션 반환
4. 실패 시 에러 코드 반환

---

## 4. Rate Limit 정책

### 4.1 목적

- 무차별 대입 공격(Brute Force) 방지
- 인증 시스템 안정성 확보

### 4.2 제한 기준 (권장)

- IP 기준

  - 1분당 5~10회 로그인 시도 제한

- 이메일 기준

  - 동일 이메일 연속 실패 횟수 제한 (예: 5회)

### 4.3 제한 방식

- Redis / In-memory store / Edge KV 중 선택
- 제한 초과 시 HTTP 429 반환

---

## 5. 에러 응답 정책

- 인증 실패 시에도 **이메일 존재 여부는 노출하지 않음**
- 동일한 메시지 사용

예시:

```
이메일 또는 비밀번호가 올바르지 않습니다.
```

---

## 6. 보안 및 운영 고려사항

- 로그인 실패 로그 기록
- 비정상 패턴 탐지 시 관리자 알림 고려
- CAPTCHA는 초기에는 도입하지 않되 확장 여지 확보

---

## 7. 확장 고려

- 2FA (이메일 / OTP)
- 소셜 로그인 추가
- Device 기반 로그인 제한

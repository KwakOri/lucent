# Auth – Signup Spec

이 문서는 **회원가입(Signup)** 에 대한 상세 스펙을 정의한다.

---

## 1. 기본 원칙

- 인증 시스템은 **Supabase Auth**를 사용한다.
- Supabase 기본 이메일 인증 메일은 사용하지 않는다.
- 회원가입 전에 **이메일 사전 인증을 필수로 수행**한다.
- 이메일 발송은 **Nodemailer + 외부 SMTP**를 사용한다.

---

## 2. 회원가입 전제 조건

- 회원가입은 **이메일 인증이 완료된 사용자만 가능**하다.
- 이메일 인증 로직은 별도 문서(`spec/auth/email-verification.md`)를 따른다.

---

### 3.2 이메일 인증 확인

```
GET /api/auth/verify-email?token=xxx
```

- 처리:

  - 토큰 유효성 검사
  - 만료 여부 확인
  - 성공 시 인증 완료 처리
  - 토큰은 1회용으로 즉시 무효화

---

## 4. 회원가입 정책

- 회원가입은 **이메일 인증 완료 후에만 가능**
- 인증 완료된 이메일인지 서버에서 검증

### 회원 생성 방식

- Supabase Admin API 사용
- 서버(API Route)에서만 실행

```ts
supabase.auth.admin.createUser({
  email,
  password,
  email_confirm: true,
});
```

- Supabase에서 인증 메일을 발송하지 않음
- 이미 인증된 이메일로 계정 생성

---

## 5. 개인정보 수집 및 동의

### 5.1 수집 항목

- 이메일 (필수)
- 휴대폰 번호 (필수, 인증 없음)
- 배송 주소 (필수)

---

### 5.2 동의 정책

- 회원가입 시 개인정보 수집·이용 동의 필수
- 체크박스 방식
- 동의하지 않을 경우 회원가입 불가

### 고지 내용

- 수집 목적: 회원 식별, 주문 및 배송 처리, 고객 문의 대응
- 보유 기간: 회원 탈퇴 시까지 (법령에 따른 보관 제외)

---

## 6. 보안 및 운영 고려사항

- 인증 토큰은 랜덤/추측 불가능해야 함
- 토큰은 1회용
- 재발송 시 기존 토큰 폐기
- Service Role Key는 서버에서만 사용

---

## 7. 확장 고려

- 추후 휴대폰 인증(SMS OTP) 추가 가능성 고려
- Auth 시스템 교체 시에도 이메일 사전 인증 로직 재사용 가능
